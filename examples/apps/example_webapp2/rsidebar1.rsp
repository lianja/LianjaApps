<%@ Language=Recital %>
<html>
<head>

<!-- Right SideBar Summary styles -->
<style type="text/css">
#sidebarsummarydiv {
	padding:5px; 
	background-color:rgb(249,249,249); 
	color:darkblue;
}
#sidebarsummary {
	color:darkblue;
	background-color:#f3f3f3;
	border-radius:5px;
	-moz-border-radius:5px;
	-webkit-border-radius:5px; 
	border:1px solid lightgray; 
	padding 5px;
	margin:0px;
}
.sidebartext {
	color:darkblue;
}
.sidebarline {
	color:lightgray;
}
.body {
	margin:0px;
	padding:0px;
}

</style>
</head>

<!-- Right SideBar Summary -->
<%
	private m_count = 0
	private m_total = 0
	private m_min = 0
	private m_max = 0
	private m_ordertotal = 0
	private m_linetotal = 0
	
	if isServer()
		private p_customerid = getParameter("customer", "")
		if not empty(p_customerid)
			open database southwind
			use order_details order orderid in 0
			use orders order customerid in 0 current
			use customers order customerid in 0 current
			seek p_customerid
		endif
	else
		save recordview
	endif
	
	if used("orders") and used("customers")
		select orders
		seek customers.customerid
		scan while customerid = customers.customerid
			++m_count
			select order_details
			seek orders.orderid
			m_ordertotal = 0
			m_linetotal = 0
			scan while orderid = orders.orderid
				m_linetotal = (order_details.unitprice*order_details.quantity) - order_details.discount
				m_ordertotal = m_ordertotal + m_linetotal
			endscan
			if m_min = 0 or m_min > m_ordertotal
				m_min = m_ordertotal
			endif
			if m_max = 0 or m_max < m_ordertotal
				m_max = m_ordertotal
			endif
			m_total = m_total + m_ordertotal
		endscan
	endif
	
	m_min = currency(m_min)
	m_max = currency(m_max)
	m_total = currency(m_total)

	if isServer()
		close database
	else
		restore recordview
	endif
		
	echo '<body class="sidebarsummary">';
	+ '<div style="background-color:#f5f5f5;-webkit-border-radius:5px; border:1px solid lightgray; padding 3px; overflow:hidden;font-size:small;">';
	+ '<table border=0px cellpadding="3px" cellspacing="0px" height="160px" width="100%">';
	+ '<tr style="font-size:small;">';
	+ '<td style="text-align:center;">';
    + "<b><font color=darkgray>Total Orders</b></font><br/><font color=gray>&m_count</font><hr size=1px color=lightgray>";
	+ "</td>";
	+ "</tr>";
	+ '<tr style="font-size:small;">';
	+ '<td style="text-align:center;">';
    + "<b><font color=darkgray>Min Order Value</b></font><br/><font color=gray>&m_min</font><hr size=1px color=lightgray>";
	+ "</td>";
	+ "</tr>";
	+ '<tr style="font-size:small;">';
	+ '<td style="text-align:center;">';
    + "<b><font color=darkgray>Max Order Value</b></font><br/><font color=gray>&m_max</font><hr size=1px color=lightgray>";
	+ "</td>";
	+ "</tr>";
	+ '<tr style="font-size:small;">';
	+ '<td style="text-align:center;">';
    + "<b><font color=darkgray>Total Order Value</b></font><br/><font color=gray>&m_total</font><br/>";
	+ "</td>";
	+ "</tr>";
	+ "</table>";
	+ "</div>";
	+ "</body>"
%>
</html>
 




